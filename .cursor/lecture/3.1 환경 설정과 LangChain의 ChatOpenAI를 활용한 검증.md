# **환경 설정과 LangChain의 ChatOpenAI를 활용한 검증**

---

# **Anaconda 가상환경 설정**

1. 가상환경 생성
    ```bash
    conda create -n inflearn-llm-application python=3.10
    ```
2. 가상환경 활성화 / 비활성화
    ```bash
    conda activate inflearn-llm-application
    conda deactivate
    ```
3. 가상환경 관리
    - 목록 확인: `conda env list`
    - 삭제: `conda remove --name 환경이름 --all`
    - 복제: `conda create --name 새이름 --clone 기존이름`

---

# **LangChain + OpenAI 환경 구성**

1. 패키지 설치
    ```bash
    pip install langchain langchain-openai python-dotenv
    ```
2. `.env` 파일 생성
    ```
    OPENAI_API_KEY=sk-proj-...
    ```
3. 코드에서 환경변수 로드
    ```python
    from dotenv import load_dotenv
    load_dotenv()
    ```
    - `load_dotenv()`가 `.env` 파일의 변수를 `os.environ`에 로드
    - `ChatOpenAI()`는 내부적으로 `os.environ["OPENAI_API_KEY"]`를 자동으로 읽음
4. LLM 호출
    ```python
    from langchain_openai import ChatOpenAI

    llm = ChatOpenAI(model="gpt-4o-mini", temperature=0)
    ai_message = llm.invoke("인프런에 어떤 강의가 있나요?")
    ai_message.content
    ```

---

# **OpenAI API 키 발급 및 과금 이슈**

1. API 키 발급
    - https://platform.openai.com/api-keys 에서 발급
    - **프로젝트별로 API 키가 다름** — 결제한 프로젝트에서 키를 발급해야 함
    - `.env`에 `OPENAI_API_KEY=발급받은키` 형식으로 저장
2. 무료 체험(Free trial) 크레딧 소진 시
    - `RateLimitError 429 - insufficient_quota` 에러 발생
    - https://platform.openai.com/account/billing 에서 잔액 확인
    - 결제 수단 등록 후 크레딧 충전 (최소 $5)
3. 결제 후에도 429 에러가 발생하는 경우
    - 이전 프로젝트(Free trial)에서 발급한 API 키를 그대로 사용하면 발생
    - **결제한 프로젝트에서 새 API 키를 발급**받아 `.env`에 교체해야 함
4. 비용 절감을 위한 모델 선택

    | model | input (1M tokens) | output (1M tokens) |
    |---|---|---|
    | **gpt-4o-mini** | **$0.15** | **$0.60** |
    | gpt-3.5-turbo | $0.50 | $1.50 |
    | gpt-4o | $2.50 | $10.00 |

    - `gpt-4o-mini`가 가장 저렴하면서 `gpt-3.5-turbo`보다 성능도 우수
    - `ChatOpenAI(model="gpt-4o-mini", temperature=0)` 으로 설정
5. Usage limits 설정 권장
    - https://platform.openai.com/account/limits 에서 월간 사용 한도 설정
    - 예상치 못한 과금 방지
